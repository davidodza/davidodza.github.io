---
layout: post
published: false
categories:
  - personal
mathjax: false
featured: false
comments: true
title: Brainpan
description: ''
headline: ''
modified: ''
tags: ''
imagefeature: ''
---

This is a walk-through of CTF challenge [Brainpan: 1](https://www.vulnhub.com/entry/brainpan-1,51/). I downloaded the target VM image from vulhub and booted it in VMware. My source machine is a Kali Linux image, also running on VMware.

All my engagements start with netdiscover, which is why I scripted a smarter version I call [netDiscoverVM](https://github.com/davidodza/Pre-OSCP/blob/master/netdiscoverVM.bash). This shows the IP address of our target machine (192.168.226.128).

![netdiscover.PNG]({{site.baseurl}}/images/brainpan/netdiscover.PNG)

Then I use Sparta to run nmap and nikto scans on the target.

![sparta.PNG]({{site.baseurl}}/images/brainpan/sparta.PNG)

I connect to the target on port 9999 and it results in a "brainpan" banner and a password input screen.

![nc1.PNG]({{site.baseurl}}/images/brainpan/nc1.PNG)

I run dirb (directory buster) on port 10000 and see a /bin directory.

![dirb.PNG]({{site.baseurl}}/images/brainpan/dirb.PNG)

The /bin directory contains one EXE.

![ip slash bin.PNG]({{site.baseurl}}/images/brainpan/ip slash bin.PNG)

I download the EXE and copy it to another folder.

![cp bpan.PNG]({{site.baseurl}}/images/braipan/cp bpan.PNG)

I run strings on the EXE. It looks like the same banner from port 9999 is in this file.

![strings.PNG]({{site.baseurl}}/images/brainpan/strings.PNG)

I run the EXE locally with OllyDbg.

![olly1.PNG]({{site.baseurl}}/images/brainpan/olly1.PNG)

Using Python, I use connect() for a socket connection and send "\x41"*1000, also known as 1000 A's.

![overflow41.PNG]({{site.baseurl}}/images/brainpan/overflow41.PNG)

![Register41paint.PNG]({{site.baseurl}}/images/brainpan/Register41paint.PNG)

![cyclic.PNG]({{site.baseurl}}/images/brainpan/cyclic.PNG)

![RegisterCyclic.PNG]({{site.baseurl}}/images/brainpan/RegisterCyclic.PNG)

![cyclicfind.PNG]({{site.baseurl}}/images/brainpan/cyclicfind.PNG)

![lasttest.PNG]({{site.baseurl}}/images/brainpan/lasttest.PNG)

![RegisterVerification.PNG]({{site.baseurl}}/images/brainpan/RegisterVerification.PNG)

![ROPgadgetJmpCall.PNG]({{site.baseurl}}/images/brainpan/ROPgadgetJmpCall.PNG)

![packJmpESP.PNG]({{site.baseurl}}/images/brainpan/packJmpESP.PNG)

![msfvenom.PNG]({{site.baseurl}}/images/brainpan/msfvenom.PNG)

![catShell.PNG]({{site.baseurl}}/images/brainpan/catShell.PNG)

![overFlowDone.PNG]({{site.baseurl}}/images/brainpan/overFlowDone.PNG)

![firstShell.PNG]({{site.baseurl}}/images/brainpan/firstShell.PNG)

![spawn bash.PNG]({{site.baseurl}}/images/brainpan/spawn bash.PNG)

![validate.PNG]({{site.baseurl}}/images/brainpan/validate.PNG)

![testvalidate.PNG]({{site.baseurl}}/images/brainpan/testvalidate.PNG)

![base64validate.PNG]({{site.baseurl}}/images/brainpan/base64validate.PNG)

![validateonhost.PNG]({{site.baseurl}}/images/brainpan/validateonhost.PNG)

![validatehosttest.PNG]({{site.baseurl}}/images/brainpan/validatehosttest.PNG)

![gdb1.PNG]({{site.baseurl}}/images/brainpan/gdb1.PNG)

![rop2.PNG]({{site.baseurl}}/images/brainpan/rop2.PNG)

There are 116 bytes to work with before the return pointer. The shellcode is 28 bytes, therefore I will have 88 bytes of nops. I divide the nops somewhat evenly around the shellcode.

![overflow2.PNG]({{site.baseurl}}/images/brainpan/overflow2.PNG)

![overflowLocal2.PNG]({{site.baseurl}}/images/brainpan/overflowLocal2.PNG)

![root.PNG]({{site.baseurl}}/images/brainpan/root.PNG)
